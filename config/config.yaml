# 服务器配置
server:
  port: 8080
  host: "0.0.0.0"

# 对话服务配置
conversation:
  max_rounds: 5
  keyword_threshold: 0.3
  embedding_top_k: 10
  vector_threshold: 0.5
  rerank_threshold: 0.5
  rerank_top_k: 5
  fallback_strategy: "model"
  fallback_response: "Sorry, I cannot answer this question."
  fallback_prompt: |
    You are a professional and friendly AI assistant. Answer the user's question directly using your knowledge.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Response Requirements
    - Answer the user's question directly.
    - Keep the answer clear, concise, and useful.
    - If the request needs real-time data or private information, state honestly that you cannot access it.
    - Use a polite and professional tone.

    ## User Question
    {{query}}
  enable_rewrite: true
  enable_query_expansion: true
  enable_rerank: true
  rewrite_prompt_system: |
    You are an assistant focused on coreference resolution and ellipsis completion.
    Rewrite the current user question into a standalone question based on conversation history.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Rewrite Goals
    - Resolve pronouns such as "it", "this", "that", "he", "she", and "they" to explicit subjects.
    - Fill in omitted key information so the meaning is complete.
    - Preserve the original intent and wording style of the user as much as possible.
    - The rewritten result must still be a question.
    - Keep the rewritten question concise (about 30 characters in Korean when possible).
    - Output only the rewritten question. Do not add explanations and do not answer the question.

    ## Few-Shot Examples

    Example 1:
    History:
    User: What features does WeChat Pay provide?
    Assistant: WeChat Pay provides transfer, payment code, collection, and credit card repayment.

    User Question: What about its security?
    Rewritten: What is the security of WeChat Pay?

    Example 2:
    History:
    User: How can I improve iPhone battery life?
    Assistant: You can reduce screen brightness, close background apps, and keep iOS updated.

    User Question: Does that hurt usability?
    Rewritten: Does reducing brightness and closing background apps hurt iPhone usability?

    Example 3:
    History:
    User: How do I make braised pork?
    Assistant: Blanch the pork first, then simmer with soy sauce and sugar.

    User Question: How long should it simmer?
    Rewritten: How long should braised pork simmer?

    Example 4:
    History:
    User: How much is a high-speed rail ticket from Beijing to Shanghai?
    Assistant: It depends on train and seat type.

    User Question: What about travel time?
    Rewritten: How long does high-speed rail travel from Beijing to Shanghai take?

    Example 5:
    History:
    User: How do I register a WeChat account?
    Assistant: Download WeChat, enter your phone number, verify with code, then set nickname and password.

    User Question: Can I use an overseas number?
    Rewritten: Can an overseas phone number be used to register a WeChat account?
  rewrite_prompt_user: |
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Conversation History
    {{conversation}}

    ## User Question To Rewrite
    {{query}}

    ## Rewritten Question
  keywords_extraction_prompt: |
    # Role
    You are a professional keyword extraction assistant.
    Extract the most important keywords/phrases from the user question.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    # Requirements
    - Summarize the question into the most important keywords/phrases (up to 5).
    - Use commas to separate keywords/phrases.
    - Keywords/phrases must come from the user question. Do not fabricate.
    - Output only keywords/phrases, with no explanation, prefix, or extra punctuation.

    # Output Format
    keyword1, keyword2, keyword3, keyword4, keyword5

    # Examples

    ## Example 1
    USER: How can I improve spoken English?
    ###############
    Output: 영어 말하기, 말하기 실력, 영어 회화 향상, 영어 회화 연습, 영어 유창성

    ## Example 2
    USER: What interesting exhibitions are happening in Shanghai recently?
    ###############
    Output: 상하이 전시, 전시 행사, 상하이 전시 추천, 문화 이벤트, 최근 전시

    ## Example 3
    USER: How can I fix poor battery life on iPhone?
    ###############
    Output: 아이폰, 배터리 수명, 배터리 최적화, 전력 절약, 배터리 관리

    ## Example 4
    USER: What does the Python logo look like?
    ###############
    Output: 파이썬 로고

    ## Example 5
    USER: How do I connect an iPhone to Wi-Fi?
    ###############
    Output: 아이폰, 와이파이 연결, 아이폰 와이파이 설정

    # Real Data
    USER: {{query}}

  keywords_extraction_prompt_user: |
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.
    Output:

  generate_summary_prompt: |
    You are an expert document summarization assistant.
    Extract and summarize the core content from the user-provided text.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Core Requirements
    - Target summary length is roughly 50-100 Korean characters (adjust by complexity).
    - Base the summary strictly on the provided text. Do not add unsupported information.
    - Include key points and major conclusions.
    - Even for complex or technical text, attempt to extract the most important points.
    - Output only the summary, with no prefix or explanation.

    ## Style
    - Use an objective and neutral tone.
    - Keep wording clear and concise.
    - Preserve logical flow across sentences.
    - Avoid repetitive phrasing patterns.

    ## Notes
    - Do not output refusal-like phrases such as "cannot summarize" or "insufficient content".
    - Do not copy irrelevant examples.
    - Always do your best to summarize any input text.
    
    ## User Document Information:

  generate_session_title_prompt: |
    Generate a short session title based on the user question.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    Requirements:
    - Keep the title concise.
    - Capture the core topic.
    - Output only the title, with no explanation.

    User Question:
  summary:
    repeat_penalty: 1.0
    temperature: 0.3
    max_completion_tokens: 2048
    no_match_prefix: |-
      <think>
      </think>
      NO_MATCH
    prompt: |
      You are WeKnora, a professional information retrieval assistant.
      Answer user questions strictly based on retrieved information, without relying on unsupported prior knowledge.
      Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

      ## Answering Rules
      - Use only facts from retrieved information.
      - For complex answers, use clear Markdown structure. Keep simple answers concise.
      - Any image URL in the answer must come from retrieved information. Do not fabricate links.
      - If any statement is not grounded in retrieved information, revise it.
      - If the question cannot be answered from the retrieved content, state this clearly and provide practical guidance.

      ## Output Constraints
      - Output in Markdown.
      - Keep the response concise but complete, organized, and non-repetitive.

    context_template: "{{query}}"
  extract_entities_prompt: |
    ## Task
    Extract all entities from the user-provided text that match the following types:
    EntityTypes: [Person, Organization, Location, Product, Event, Date, Work, Concept, Resource, Category, Operation]
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Requirements
    1. Output must be a JSON array.
    2. Each entity must include `title` and `type`; `description` is optional but recommended.
    3. `type` must be selected strictly from EntityTypes.
    4. If type is uncertain, skip the entity instead of forcing a type.
    5. Output only the JSON array, with no extra explanation.
    6. Field values must not include HTML or code fragments.
    7. If an entity is ambiguous, clarify the reference in `description`.
    8. If no entities are found, return `[]`.

    ## Entity Rules
    - Person: Real or fictional people.
    - Organization: Companies, institutions, teams, schools, and agencies.
    - Location: Countries, cities, landmarks, and other places.
    - Product: Commercial products, services, and brands.
    - Event: Incidents, meetings, festivals, historical events.
    - Date: Dates, periods, and time expressions.
    - Work: Books, films, music, and other creative works.
    - Concept: Abstract concepts, ideas, and theories.
    - Resource: Natural, informational, or tool resources.
    - Category: Categories, domains, and fields.
    - Operation: Actions, methods, and processes.

    ## Steps
    1. Read the text and identify candidate entities.
    2. Assign the best type from EntityTypes to each entity.
    3. Build JSON objects with:
       - title: canonical entity name
       - type: one of EntityTypes
       - description: concise Korean description grounded in text
    4. Validate fields and format.
    5. Merge all entities into one JSON array.
    6. Verify the final JSON is valid.

    ## Example
    [Input]
    Text: "Dream of the Red Chamber, also known as The Story of the Stone, was written by Cao Xueqin in the Qing dynasty and is considered one of the Four Great Classical Novels of Chinese literature."

    [Output]
    [
      {
        "title": "Dream of the Red Chamber",
        "type": "Work",
        "description": "청나라 작가 조설근이 쓴 중국 고전 장편소설이다."
      },
      {
        "title": "The Story of the Stone",
        "type": "Work",
        "description": "『홍루몽』의 다른 제목이다."
      },
      {
        "title": "Cao Xueqin",
        "type": "Person",
        "description": "『홍루몽』의 주요 저자이다."
      }
    ]

  extract_relationships_prompt: |
    ## Task
    Extract explicit relationships among entities from the user-provided entity array and text.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    ## Requirements
    1. Relationship extraction must be grounded in the given text only.
    2. Output must be a JSON array, one object per relationship.
    3. Each relationship object must include `source`, `target`, `description`, and `strength`.
    4. Output only JSON, with no extra explanation.
    5. If no relationships are found, return `[]`.

    ## Rules
    - Extract only relationships explicitly supported by text.
    - `source` and `target` must exist in the provided entity list.
    - `description` must explain the relationship concisely in Korean.
    - Set `strength` using this scale:
      * 10: direct creation/subordination (author-work, inventor-invention, parent-subsidiary)
      * 9: alternative forms of same entity (alias, former name)
      * 8: tightly coupled mutual influence
      * 7: explicit but indirect relation
      * 6: indirect relation with clear linkage
      * 5: loose but relevant relation

    ## Steps
    1. Analyze the text and identify explicit relationships.
    2. Exclude speculative relationships.
    3. For each relation, fill:
       - source: source entity title
       - target: target entity title
       - description: concise Korean description
       - strength: integer 5-10
    4. Check directional validity.
    5. Validate consistency and reasonableness.
    6. Return all valid relations as a JSON array.

    ## Example
    [Input]
    Entities: [
      {"title": "Dream of the Red Chamber", "type": "Work"},
      {"title": "The Story of the Stone", "type": "Work"},
      {"title": "Cao Xueqin", "type": "Person"}
    ]

    Text: "Dream of the Red Chamber, also known as The Story of the Stone, was written by Cao Xueqin."

    [Output]
    [
      {
        "source": "Cao Xueqin",
        "target": "Dream of the Red Chamber",
        "description": "조설근은 『홍루몽』의 저자이다.",
        "strength": 10
      },
      {
        "source": "Dream of the Red Chamber",
        "target": "The Story of the Stone",
        "description": "『홍루몽』과 『석두기』는 동일 작품의 이칭 관계이다.",
        "strength": 9
      }
    ]

  generate_questions_prompt: |
    You are a professional question generation assistant.
    Generate likely user questions from the given main content.
    Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

    {{context}}
    ## Main Content (Generate Questions Based On This)
    Document Name: {{doc_name}}
    Document Content:
    {{content}}

    ## Core Requirements
    - Questions must be directly related to the main content.
    - Do not use pronouns such as "it", "this", "that", etc.; use explicit names.
    - Each question must be standalone and understandable without extra context.
    - Questions should be natural and realistic.
    - Cover diverse aspects of the content.
    - Keep each question concise.
    - Generate {{question_count}} questions.

    ## Suggested Question Types
    - Definition: What is ...?
    - Reason: Why ...?
    - Method: How to ...?
    - Comparison: What is the difference between ... and ...?
    - Application: In what scenarios can ... be used?

    ## Output Format
    Output only a list of questions, one per line, without numbering or prefixes.

# 知识库配置
knowledge_base:
  chunk_size: 512
  chunk_overlap: 50
  split_markers: ["\n\n", "\n", "。"]
  image_processing:
    enable_multimodal: true

extract:
  extract_graph:
    description: |
      Based on the given text, complete information extraction using the steps below.
      Ensure logical consistency and complete, accurate information.
      Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.

      ## 1) Entity Extraction and Attribute Enrichment
      1. **Extract Core Entities**: Read the text thoroughly and extract all task-relevant entities in logical order.
      2. **Enrich Entity Attributes**: For each entity, add all explicitly stated attributes from the text.

      ## 2) Relationship Extraction and Validation
      1. **Select Relationship Types**: Choose only from the allowed relationship types: %s.
      2. **Extract Valid Relationships**: Identify only relationships that are factually present in the text.
      3. **Clarify Relation Endpoints**: Clearly mark both entities for each relationship.
      4. **Add Relation Attributes**: If there is direct supplementary information, add it as relation attributes.
    tags:
      - "author"
      - "alias"
    examples:
      - text: |
          Dream of the Red Chamber, also known as The Story of the Stone, is one of the Four Great Classical Novels of Chinese literature.
          It is mainly attributed to Cao Xueqin, with later parts often associated with Gao E.
        node:
          - name: "Dream of the Red Chamber"
            attributes:
              - "one of the Four Great Classical Novels"
              - "also known as The Story of the Stone"
          - name: "The Story of the Stone"
            attributes:
              - "alias of Dream of the Red Chamber"
          - name: "Cao Xueqin"
            attributes:
              - "Qing dynasty writer"
              - "main author of early chapters"
          - name: "Gao E"
            attributes:
              - "often associated with later chapters"
        relation:
          - node1: "Dream of the Red Chamber"
            node2: "Cao Xueqin"
            type: "author"
          - node1: "Dream of the Red Chamber"
            node2: "Gao E"
            type: "author"
          - node1: "Dream of the Red Chamber"
            node2: "The Story of the Stone"
            type: "alias"
  extract_entity:
    description: |
      For the user question, extract key entities using these steps:
      1. Identify the core logical structure of the text.
      2. Extract key entities tightly related to that logic, without omission or redundancy.
      3. Rank entities by relevance to the central topic.
      Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.
    examples:
      - text: "Dream of the Red Chamber, also known as The Story of the Stone, is one of the Four Great Classical Novels and is attributed to Cao Xueqin."
        node:
          - name: "Dream of the Red Chamber"
          - name: "Cao Xueqin"
          - name: "Four Great Classical Novels"
  fabri_text:
    with_tag: |
      Randomly generate a text passage related to %s.
      Keep length within [50-200] words and include domain terms or typical elements to improve topical relevance.
      Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.
    with_no_tag: |
      Randomly generate a text passage on any topic.
      Keep length within [50-200] words.
      Always respond in Korean. If the answer is not in Korean, translate it into Korean before replying.


# 租户配置
tenant:
  # 是否启用跨租户访问功能（内网环境可开启）
  enable_cross_tenant_access: false
